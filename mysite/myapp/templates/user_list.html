{% extends 'base.html' %}

{% load tz %}  <!-- Добавьте этот тег для загрузки фильтра timezone -->

{% block title %}Список пользователей{% endblock %}

{% block content %}
    <h2>Список пользователей</h2>
    <table>
        <thead>
            <tr>
                <th>Логин</th>
                <th>Email</th>
                <th>Имя</th>
                <th>Фамилия</th>
                <th>Дата регистрации</th>
                <th>Роль</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
                <tr>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.first_name }}</td>
                    <td>{{ user.last_name }}</td>
                    <td>{{ user.date_joined|timezone:"Europe/Moscow"|date:"d.m.Y H:i" }}</td>
                    <td>
                        {% if user.is_staff %}
                            Администратор
                        {% else %}
                            Пользователь
                        {% endif %}
                    </td>
                    <td>
                        <form method="post" action="{% url 'delete_user' user.id %}" onsubmit="return confirm('Вы уверены, что хотите удалить этого пользователя?');">
                            {% csrf_token %}
                            <button type="submit">Удалить</button>
                        </form>
                        <form method="post" action="{% url 'toggle_staff_status' user.id %}" onsubmit="return confirm('Вы уверены, что хотите изменить роль этого пользователя?');">
                            {% csrf_token %}
                            <button type="submit">
                                {% if user.is_staff %}
                                    Снять роль администратора
                                {% else %}
                                    Выдать роль администратора
                                {% endif %}
                            </button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}